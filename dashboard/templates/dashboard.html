<!DOCTYPE html>
<html>

<head>
    <title>VIP SQLi Scanner Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.5.4/socket.io.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            background-color: #f8f9fa;
        }

        .card {
            border: none;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .badge-vuln {
            background-color: #dc3545;
        }

        .badge-safe {
            background-color: #28a745;
        }
    </style>
</head>

<body>
    <div class="container mt-4">
        <header class="mb-5 pb-3 border-bottom d-flex justify-content-between align-items-center">
            <h1>ðŸ”¥ VIP SQLi Scanner <span class="badge bg-secondary fs-6">v2.2</span></h1>
            <div id="connection-status" class="badge bg-success">Connected</div>
        </header>

        <div class="row mt-4">
            <div class="col-md-3">
                <div class="card bg-primary text-white">
                    <div class="card-body">
                        <h6>Total URLs</h6>
                        <h2 id="total">0</h2>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card bg-success text-white">
                    <div class="card-body">
                        <h6>Safe</h6>
                        <h2 id="safe">0</h2>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card bg-danger text-white">
                    <div class="card-body">
                        <h6>Vulnerable</h6>
                        <h2 id="vuln">0</h2>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card">
                    <div class="card-body">
                        <canvas id="chart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <div class="mt-4 mb-5">
            <h6>Scan Progress</h6>
            <div class="progress" style="height: 20px;">
                <div id="progress-bar" class="progress-bar progress-bar-striped progress-bar-animated"
                    style="width: 0%"></div>
            </div>
        </div>

        <div class="card">
            <div class="card-header bg-white">
                <h5 class="mb-0">Live Results</h5>
            </div>
            <div class="card-body p-0">
                <div class="table-responsive" style="max-height: 500px">
                    <table class="table table-hover mb-0">
                        <thead class="table-light sticky-top">
                            <tr>
                                <th>Timestamp</th>
                                <th>URL</th>
                                <th>Verdict</th>
                                <th>Details</th>
                            </tr>
                        </thead>
                        <tbody id="results-body">
                            <!-- Rows added dynamically -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        const socket = io();
        const ctx = document.getElementById('chart').getContext('2d');
        const chart = new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: ['Safe', 'Vulnerable'],
                datasets: [{
                    data: [0, 0],
                    backgroundColor: ['#28a745', '#dc3545'],
                    borderWidth: 0
                }]
            },
            options: { cutout: '70%', responsive: true, plugins: { legend: { display: false } } }
        });

        socket.on('connect', () => {
            document.getElementById('connection-status').className = 'badge bg-success';
            document.getElementById('connection-status').textContent = 'Connected';
        });

        socket.on('disconnect', () => {
            document.getElementById('connection-status').className = 'badge bg-danger';
            document.getElementById('connection-status').textContent = 'Disconnected';
        });

        socket.on('scan_update', (data) => {
            // Update stats
            document.getElementById('total').textContent = data.total;
            document.getElementById('safe').textContent = data.stats.safe;
            document.getElementById('vuln').textContent = data.stats.vulnerable;

            // Update Progress
            const pct = data.total > 0 ? (data.progress / data.total) * 100 : 0;
            document.getElementById('progress-bar').style.width = pct + '%';

            // Update Chart
            chart.data.datasets[0].data = [data.stats.safe, data.stats.vulnerable];
            chart.update();

            // Add Row
            const tbody = document.getElementById('results-body');
            const row = document.createElement('tr');
            const result = data.latest;

            const badgeClass = result.verdict === 'VULNERABLE' ? 'badge-vuln' :
                result.verdict === 'SAFE' ? 'badge-safe' : 'bg-warning';

            row.innerHTML = `
                <td>${new Date().toLocaleTimeString()}</td>
                <td class="text-truncate" style="max-width: 400px;">${result.url}</td>
                <td><span class="badge ${badgeClass}">${result.verdict}</span></td>
                <td class="small text-muted">${result.details || ''}</td>
            `;

            tbody.insertBefore(row, tbody.firstChild);

            // Keep list manageable
            if (tbody.children.length > 100) {
                tbody.removeChild(tbody.lastChild);
            }
        });
    </script>
</body>

</html>